<?xml version="1.0" encoding="utf-8"?>
<!-- vim:fdn=3:
-->

<openerp>
    <data>

        <!-- server action used to create the call from the menu "more" in the lead's list view -->
        <record id="action_create_call_center_call" model="ir.actions.server">
            <field name="name">Create call center call</field>
            <field name="model_id" ref="crm.model_crm_lead"/>
            <field name="state">code</field>
            <field name="code">
                if context.get('active_model') == 'crm.lead':
                    ids = []
                    if(context['active_ids']):
                        ids = context['active_ids']
                    else:
                        ids = context['opportunity_id']
                    self.create_call_center_call(cr, uid, ids, context=context)
            </field>
        </record>

        <!-- insertion of the action "Add to Call Center" in the "more" menu in the lead's list view -->
        <record model="ir.values" id="ir_create_call_center_call">
            <field name="model_id" ref="crm.model_crm_lead" />
            <field name="name">Add to Call Center</field>
            <field name="key2">client_action_multi</field>
            <field eval="'ir.actions.server,%d'%action_create_call_center_call" name="value"/>
            <field name="key">action</field>
            <field name="model">crm.lead</field>
        </record>

        <!-- Add the button in the kaban view of the opportunities-->
        <record model="ir.ui.view" id="lead_button_call_kanban_view">
            <field name="name">crm.lead.tocall</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_kanban_view_leads"/>
            <field name="arch" type="xml">
                <div class="oe_kanban_content">
                     <a href="#" title="Add to call center calls" class="oe_dial_link_icon">
                        <i class="text-muted oe_dial_hidden_button oe_dial_lead_to_call_center_button fa fa-plus-square"></i>
                    </a>
                </div>
            </field>
        </record>
    </data>
</openerp>

